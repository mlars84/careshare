myApp.service("careShareService",["$http","$location",function($http,$location){const vm=this;vm.users={list:[]},vm.profiles={names:[]},vm.careShares={shares:[]},vm.checkUserSession=function(){$http.get("/user").then(function(response){response.data.username?(vm.userName=response.data.username,vm.userId=response.data._id,console.log("User Data: ",vm.userName,vm.userId)):$location.path("/home")})},vm.checkUserSession(),vm.getUsers=function(){vm.checkUserSession(),console.log("getting all other users list"),$http({method:"GET",url:"/careshare/getUsers"}).then(function(res){console.log(res.data),vm.users.list=[],console.log(vm.users.list);for(var i=0;i<res.data.length;i++)console.log(res.data[i].username,vm.userName),res.data[i].username!==vm.userName&&(vm.users.list.push(res.data[i]),console.log())})},vm.getProfilesToShare=function(){console.log("in getProfilesToShare"),$http({method:"GET",url:"/careshare/getProfilesToShare"}).then(function(res){console.log("res.data =>",res.data),vm.profiles.names=[],vm.getCareShares(res.data);for(var i=0;i<res.data.length;i++)console.log(res.data[i].userCreated),res.data[i].userCreated===vm.userId&&vm.profiles.names.push(res.data[i])})},vm.getProfilesToShare(),vm.returnToProfile=function(){console.log("back to profile button clicked!"),$location.path("/profile"),vm.clearUsers()},vm.clearUsers=function(){vm.users.list=[]},vm.shareProfile=function(user,profile){console.log("share button clicked!"),console.log("user =>",user,"profile =>",profile);const careShareToSend={userToShareWith:user,careProfileToShare:profile};console.log(careShareToSend),$http({method:"PUT",url:"/careshare/shareProfile",data:careShareToSend}).then(function(res){console.log(res.data),swal(profile.name+" has been shared with "+user.username+"!")})},vm.getCareShares=function(allProfiles){console.log("in getCareShares function"),console.log(allProfiles),vm.careShares.shares=[];for(var i=0;i<allProfiles.length;i++){console.log("allProfiles[i] =>",allProfiles[i]);for(var sharedWithArray=allProfiles[i].sharedWith,j=0;j<sharedWithArray.length;j++)console.log("sharedWithArray[j] =>",sharedWithArray[j]),sharedWithArray[j].userId==vm.userId?(console.log(sharedWithArray[j].userId),vm.careShares.shares.push(allProfiles[i]),console.log("vm.careShares.shares =>",vm.careShares.shares)):console.log("NO MATCH!")}}}]);
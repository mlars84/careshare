myApp.service("careShareService",["$http","$location",function($http,$location){const vm=this;vm.users={list:[]},vm.profiles={names:[]},vm.careShares={shares:[]},vm.checkUserSession=function(){$http.get("/user").then(function(response){response.data.username?(vm.userName=response.data.username,vm.userId=response.data._id):$location.path("/home")})},vm.checkUserSession(),vm.getUsers=function(){vm.checkUserSession(),$http({method:"GET",url:"/careshare/getUsers"}).then(function(res){vm.users.list=[];for(var i=0;i<res.data.length;i++)res.data[i].username!==vm.userName&&vm.users.list.push(res.data[i])})},vm.getProfilesToShare=function(){$http({method:"GET",url:"/careshare/getProfilesToShare"}).then(function(res){vm.profiles.names=[],vm.getCareShares(res.data);for(var i=0;i<res.data.length;i++)res.data[i].userCreated===vm.userId&&vm.profiles.names.push(res.data[i])})},vm.getProfilesToShare(),vm.returnToProfile=function(){$location.path("/profile"),vm.clearUsers()},vm.clearUsers=function(){vm.users.list=[]},vm.shareProfile=function(user,profile){$http({method:"PUT",url:"/careshare/shareProfile",data:{userToShareWith:user,careProfileToShare:profile}}).then(function(res){swal(profile.name+" has been shared with "+user.username+"!")})},vm.getCareShares=function(allProfiles){vm.careShares.shares=[];for(var i=0;i<allProfiles.length;i++)for(var sharedWithArray=allProfiles[i].sharedWith,j=0;j<sharedWithArray.length;j++)sharedWithArray[j].userId==vm.userId&&vm.careShares.shares.push(allProfiles[i])}}]);
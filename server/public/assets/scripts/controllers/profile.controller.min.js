myApp.controller("profileController",["$scope","$http","$location","profileService",function($scope,$http,$location,profileService){const vm=this;vm.userProfiles=[],vm.pix="",vm.showPicker=function(pix){filestack.init("ArXNtpO4Rwsqv9KTeHucgz").pick({}).then(function(result){vm.pix={url:result.filesUploaded[0].url}})},vm.showPicker(),$scope.nameIn={imageUrl:"Profile Name"},$http.get("/user").then(function(response){response.data.username?(vm.userName=response.data.username,vm.userId=response.data._id,vm.getUserProfiles()):$location.path("/home")}),vm.logout=function(){$http.get("/user/logout").then(function(res){swal("Thanks for CareSharing!"),$location.path("/home")})},vm.addProfile=function(){var profileToSend={imageUrl:vm.pix.url,name:vm.nameIn,age:vm.ageIn,basicInfo:vm.basicInfoIn,careInfo:vm.careInfoIn,emergencyContacts:vm.emergencyContactsIn,userCreated:vm.userId,sharedWith:[]};$http({method:"POST",url:"/user/addProfile",data:profileToSend}).then(function(res){vm.clearInputs(),vm.getUserProfiles(),swal("Good job!","CareProfile created! Scroll down to check it out.","success")})},vm.clearInputs=function(){vm.imageUrl="",vm.nameIn="",vm.ageIn="",vm.basicInfoIn="",vm.careInfoIn="",vm.emergencyContactsIn=""},vm.getUserProfiles=function(){$http({method:"GET",url:"/user/getUserProfiles"}).then(function(res){vm.userProfiles=[];for(var i=0;i<res.data.length;i++)res.data[i].userCreated===vm.userId&&vm.userProfiles.push(res.data[i])})},vm.updateProfile=function(profile){$http({method:"PUT",url:"/user/updateProfile",data:profile}).then(function(res){vm.getUserProfiles(),swal(profile.name+" has been updated!")})},vm.shareProfile=function(){$location.path("/careshare")},vm.unShare=function(profileToUnshare,currentProfile){swal({title:"Are you sure?",text:"This will unshare "+currentProfile.name+" with "+profileToUnshare.username+"!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, unshare!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){if(isConfirm){swal("Unshared!","No worries, you can always CareShare again if you'd like.","success");$http({method:"PUT",url:"/user/unShare",data:{profileToUnshare:profileToUnshare,currentProfile:currentProfile}}).then(function(res){vm.getUserProfiles()})}else swal("Cancelled",profileToUnshare.username+" still has access to "+currentProfile.name+" :)","error")})},vm.deleteProfile=function(id,profileToUnshare,currentProfile){swal({title:"Are you sure?",text:"You will not be able to recover "+currentProfile.name+"'s CareProfile!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?(swal("Deleted!",currentProfile.name+" has been deleted.","success"),$http({method:"DELETE",url:"/user/deleteProfile",params:{id:id}}).then(function(res){vm.getUserProfiles()})):swal("Cancelled",currentProfile.name+"'s CareProfile lives on :)","error")})}}]);